<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.huny.persistence.AttachmentsDAO">
    <insert id="insertAttachments" keyProperty="seq" parameterType="kr.huny.domain.board.AttachmentsVO" useGeneratedKeys="true">
        insert into attachments (
            a_seq,
            bm_seq,
            `contentType`,
            download,
            filename,
            filesize,
            save_name,
            save_path)
        values (
            #{a_seq},
            #{bm_seq},
            #{contentType},
            #{download},
            #{filename},
            #{filesize},
            #{save_name},
            #{save_path})
    </insert>
    <update id="updateAttachments">
        update attachments
            set bm_seq = #{bm_seq}, a_seq = #{a_seq}, isTemporary = 0
        where
            seq = #{seq}
    </update>
    <delete id="deleteAttachments">
        delete attachments where seq = #{seq};
    </delete>
    <select id="readAttachments" resultType="kr.huny.domain.board.AttachmentsVO">
        select
            a_seq,
            bm_seq,
            `contentType`,
            download,
            filename,
            filesize,
            save_name,
            save_path,
            seq
        from
            attachments where seq = #{seq}
    </select>
    <select id="selectAttachmentsList" resultType="kr.huny.domain.board.AttachmentsVO">
        select
            a_seq,
            bm_seq,
            `contentType`,
            download,
            filename,
            filesize,
            save_name,
            save_path,
            seq
        from
            attachments where bm_seq = #{bm_seq} and a_seq = #{a_seq}
        order by seq desc
    </select>
    <select id="selectAttachmentsCount" resultType="java.lang.Integer">
        select count(seq) from attachments where bm_seq = #{bm_seq} and a_seq = #{a_seq} and isTemporary = 0
    </select>
</mapper>